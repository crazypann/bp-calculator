<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BP Pack Calculator</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:720px;margin:20px auto;padding:18px}
  h1{font-size:1.2rem;margin:0 0 10px}
  label{display:block;margin:8px 0 4px}
  input[type=number]{width:120px;padding:6px}
  input[readonly]{background:#eee;color:#555;cursor:not-allowed;}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
  .out{background:#f7f7f8;padding:10px;border-radius:8px;margin-top:12px}
  button{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
  small{color:#666}
  .share{margin-top:8px}
</style>
</head>
<body>
  <h1>BOS Calculator</h1>
  <p><small>Enter BPs you <strong>own</strong> for each car (enter <strong>300</strong> for a maxed car).</small></p>

  <div class="row"><label>Car 1 BPs</label><input id="c1" type="number" value="300" min="0" max="300"></div>
  <div class="row"><label>Car 2 BPs</label><input id="c2" type="number" value="36" min="0" max="300"></div>
  <div class="row"><label>Car 3 BPs</label><input id="c3" type="number" value="66" min="0" max="300"></div>

  <div style="margin-top:12px" class="row">
    <div>
      <label>Tokens per 10-pack</label>
      <input id="packCost" type="number" value="750" min="1">
    </div>
    <div>
      <label>Avg BPs / 10-pack</label>
      <input id="bpPerPack" type="number" value="11.33" readonly>
    </div>
    <div>
      <label>Safety multiplier (90%)</label>
      <input id="safety" type="number" value="1.1" readonly>
    </div>
  </div>

  <div style="margin-top:14px">
    <button id="calc">Calculate</button>
    <button id="reset" style="margin-left:8px">Reset</button>
    <button id="share" style="margin-left:8px">Copy share link</button>
  </div>

  <div id="out" class="out" aria-live="polite" style="display:none"></div>

<script>
const el=(id)=>document.getElementById(id);

function qsGet(name) {
  const params = new URLSearchParams(window.location.search);
  return params.has(name) ? params.get(name) : null;
}

function prefillFromQuery() {
  const q1 = qsGet('c1'), q2 = qsGet('c2'), q3 = qsGet('c3');
  const qpc = qsGet('packCost');
  if (q1 !== null) el('c1').value = Math.min(300, Math.max(0, Number(q1)||0));
  if (q2 !== null) el('c2').value = Math.min(300, Math.max(0, Number(q2)||0));
  if (q3 !== null) el('c3').value = Math.min(300, Math.max(0, Number(q3)||0));
  if (qpc !== null) el('packCost').value = Number(qpc)||750;
}

function calc() {
  const c1 = Number(el('c1').value)||0;
  const c2 = Number(el('c2').value)||0;
  const c3 = Number(el('c3').value)||0;
  const packCost = Number(el('packCost').value)||750;
  const bpPerPack = 11.33;
  const safety = 1.1;

  const totalOwned = c1 + c2 + c3;
  const remaining = Math.max(0, 900 - totalOwned);

  const packs50 = Math.ceil(remaining / bpPerPack);
  const packs90 = Math.ceil((remaining / bpPerPack) * safety);

  const tokens50 = packs50 * packCost;
  const tokens90 = packs90 * packCost;

  const out = el('out');
  out.style.display = 'block';
  out.innerHTML = `
    <strong>Total BPs owned:</strong> ${totalOwned} <br>
    <strong>BPs remaining:</strong> ${remaining} <hr>
    <strong>Typical (50%)</strong>: ${packs50.toLocaleString()} packs — ${tokens50.toLocaleString()} tokens<br>
    <strong>Safe (90%)</strong>: ${packs90.toLocaleString()} packs — ${tokens90.toLocaleString()} tokens
  `;
}

function makeShareLink() {
  const c1 = encodeURIComponent(el('c1').value || '');
  const c2 = encodeURIComponent(el('c2').value || '');
  const c3 = encodeURIComponent(el('c3').value || '');
  const pc = encodeURIComponent(el('packCost').value || '');
  const base = window.location.origin + window.location.pathname;
  const url = `${base}?c1=${c1}&c2=${c2}&c3=${c3}&packCost=${pc}`;
  navigator.clipboard.writeText(url).then(()=>{
    alert('Share link copied to clipboard!');
  }, ()=>{
    prompt('Copy this link:', url);
  });
}

el('calc').addEventListener('click', calc);
el('reset').addEventListener('click', ()=>{
  el('c1').value=300; el('c2').value=36; el('c3').value=66; el('packCost').value=750;
  el('out').style.display='none';
});
el('share').addEventListener('click', makeShareLink);

window.addEventListener('load', ()=>{
  prefillFromQuery();
  calc();
});
</script>
</body>
</html>
